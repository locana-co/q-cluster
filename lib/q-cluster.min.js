var QCluster=function(a){var b;return b=function(a,b,c,d,e,f){var g,h,i,j,k,l;for(g=f,h=!1,i=b+c,j=a.length;!h;)i>=j||0>i?h=!0:(a[i].c||(k=Math.abs(a[i].x-a[b].x)/e,l=Math.abs(a[i].y-a[b].y)/e,g>k?g>l&&(d.points.push(a[i]),d.c=!0,a[i].c=!0):h=!0),i+=c)},a.clusterPoints=function(a,c,d,e){function f(a,b,c,d,e,f){return a>d||c>a||b>f||e>b?!1:!0}for(var g,h,i,k,l=0,m=[],n=a,o=n.length,i=o-1;i>=0;i--)n[i].c=null;for(var h=o-1;h>=0;h--)!n[h].c&&f(n[h].x,n[h].y,c.xmin,c.xmax,c.ymin,c.ymax)&&(k={id:l,points:[],xSum:0,ySum:0,cX:null,cY:null},l++,k.points.push(n[h]),b(n,h,-1,k,d,e),b(n,h,1,k,d,e),m.push(k));for(i=0,iMax=m.length;iMax>i;i++){for(g=m[i],j=0,jMax=g.points.length;jMax>j;j++)g.xSum=g.xSum+g.points[j].x,g.ySum=g.ySum+g.points[j].y;g.cX=g.xSum/g.points.length,g.cY=g.ySum/g.points.length,delete g.xSum,delete g.ySum}return m},a}(QCluster||{}),QCluster=function(a){function b(a,b,c){var d,e,f,g,h;return h=c||0,d=L.CRS.EPSG3857.project(a._southWest).x-c*b,e=L.CRS.EPSG3857.project(a._northEast).x+c*b,f=L.CRS.EPSG3857.project(a._southWest).y-c*b,g=L.CRS.EPSG3857.project(a._northEast).y+c*b,{xmin:d,xmax:e,ymin:f,ymax:g}}function c(a,b){var c,d,b,e;return e=a.getSize().x,c=L.CRS.EPSG3857.project(b._southWest).x,d=L.CRS.EPSG3857.project(b._northEast).x,(d-c)/e}function d(a,b){return a.georef<b.georef?-1:a.georef>b.georef?1:0}function e(a,b,c){function d(a,b){var c,d,e,f,g="";c=Math.pow(10,5-b),60==a&&(a=59.999),a=1e3*a,d=Math.floor(a/c),e=d.toString().length,b>e&&(f=b-e);for(var h=0;f>h;h++)g+="0";return g+=d}var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F=[],G="";if(ABC="ABCDEFGHIJKLMNOPQRSTUVWXYZABCDEFGHIJKLMNOPQRSTUVWXYZ",n=-90,o=90,p=-180,q=360,r=60,s=4,t=14,u=4,v=5,w=8,x=12,y=14,z=16,A=25,B=78,C=48,PI=3.141592653589793,D=15,E=5e-7,n>b||b>o)return null;if(p>a)return null;if(0>c||c>v)return null;for(a>180&&(a-=360),g=p,h=n,j=(a-g)/D+E,F[0]=j>=0?Math.floor(j):Math.ceil(j),k=a-(F[0]*D+g),F[2]=k>=0?Math.floor(k):Math.ceil(k)+E,e=(k-F[2])*r,l=(b-h)/D+E,F[1]=l>=0?Math.floor(l):Math.ceil(l),m=b-(F[1]*D+h),F[3]=m>=0?Math.floor(m+E):Math.ceil(m+E),f=(m-F[3])*r,i=0;4>i;i++)F[i]>=w&&(F[i]+=1),F[i]>=y&&(F[i]+=1);for(26==F[0]&&(F[0]=A,F[2]=z,e=59.999),13==F[1]&&(F[1]=x,F[3]=z,f=59.999),i=0;4>i;i++)G+=ABC[F[i]];return G+=d(e,c),G+=d(f,c)}function f(a,b){var c,d;return Math.abs(b)>20037508.3427892?(console.error("Mercator X: "+b+" is > 20037508.3427892."),[null,null]):Math.abs(a)>20037508.3427892?(console.error("Mercator Y: "+a+" is > 20037508.3427892."),[null,null]):(c=b/6378137*57.29577951308232-360*Math.floor((b/6378137*57.29577951308232+180)/360),d=57.29577951308232*(1.5707963267948966-2*Math.atan(Math.exp(-1*a/6378137))),[c,d])}return a.PointClusterer=function(a,b,c,f,g){var h,i,j,k,l,m;for(h=g||{},this.layerId=b,this.clickHandler=h.clickHandler||null,this.backgroundColor=h.backgroundColor||null,this.clusterCssClass=f,this.map=c,this.pointData=a,this.pointIdProperty=h.pointIdProperty||null,this.tolerance=h.clusterTolerance||130,this.mapEdgeBuffer=h.mapEdgeBuffer||100,this.layerVisibility="boolean"==typeof h.layerVisibility?h.layerVisibility:!0,this.reportingProperty=h.reportingProperty||null,this.reportingDictionary=h.reportingDictionary||{},this.defaultPalette=h.defaultPalette||["#8b722c","#e7dfc7","#040707","#c96228","#80adc0","#a19788","#ddecf2","#9e0000","#03671f","#8e2b5c","#e13066","#5c8276","#efa0cb","#62517b","#2c688b","#56c2a7","#e1df2f","#ed3333","#e69890","#545454"],this.mapOrder=h.mapOrder||null,this.reportingValueNA=h.reportingValueNA||{color:"#666666",label:"NA"},this.donutIRFrac=h.donutIRFrac||.4,this.activeCluster=null,i=a.length,this.pointData=[],l=i-1;l>=0;l--)k=a[l].lat,j=a[l].lng,m=L.CRS.EPSG3857.project(L.latLng(k,j)),this.pointData.push($.extend(!0,{georef:e(j,k,4),x:m.x,y:m.y},a[l]));return this.pointData.sort(d),this.makeClusters(),this.map.on("moveend",this.mapMove,this),this},a.PointClusterer.prototype.makeClusters=function(d,e,g,h){var i,j,k,l,m,n,o,p,q,h,r,s,t,u;if(clusterMarkers=[],lats=[],lngs=[],$(this.map._container).is(":visible")){for("undefined"!=typeof this.layer&&this.map.removeLayer(this.layer),h=this.map.getBounds(),r=c(this.map,h),s=b(h,r,this.mapEdgeBuffer),i=a.clusterPoints(this.pointData,s,r,this.tolerance),j={},t=i.length,u=t-1;u>=0;u--){j["cId_"+i[u].id]=i[u],o=i[u].points,k=o.length,l=this.backgroundColor?'<div style="background-color: '+this.backgroundColor+';"><span>'+k+"</span></div>":"<div><span>"+k+"</span></div>",m="leaflet-marker-icon q-marker-cluster "+this.clusterCssClass,1===k?(l='<div><div class="q-marker-single-default"><span>'+k+"</span></div></div></div>",m+=" q-marker-cluster-single",null!==this.reportingProperty&&(q=o[0][this.reportingProperty].toString().split(","),"undefined"!=typeof this.reportingDictionary[q[0]]&&(l='<div style="background-color: '+this.reportingDictionary[q[0]].color+'"><div class="q-marker-single-default"><span>'+k+"</span></div></div></div>"))):m=100>k?m+" q-marker-cluster-small cId_"+i[u].id:1e3>k?m+" q-marker-cluster-medium cId_"+i[u].id:m+" q-marker-cluster-large cId_"+i[u].id,n=L.divIcon({className:m,html:l});var v=f(i[u].cY,i[u].cX);if(p=L.marker([v[1],v[0]],{icon:n}),p.points=o,p.pointIds=[],this.pointIdProperty)for(var w=o.length-1;w>=0;w--)p.pointIds.push(o[w][this.pointIdProperty]);p.stacked=!0,lats[0]=Math.round(1e4*o[0].lat)/1e4,lngs[0]=Math.round(1e4*o[0].lng)/1e4;for(var x=o.length-1;x>=0;x--)if(lats[x]=Math.round(1e4*o[x].lat)/1e4,lngs[x]=Math.round(1e4*o[x].lng)/1e4,lats[x]!==lats[0]||lngs[x]!==lngs[0]){p.stacked=!1;break}if(this.clickHandler&&(this.clickHandler&&p.on("click",this.clickHandler,this),this.idProperty)){p.pointIds=[];for(var w=0,y=k;y>w;w++)p.pointIds.push(o[w][this.idProperty])}clusterMarkers.push(p)}this.clusters=j,this.layer=L.featureGroup(clusterMarkers),this.map.addLayer(this.layer),this.layerVisibility&&(this.map.addLayer(this.layer),"number"==typeof this.mapOrder&&$("."+this.layerId).css("z-index",this.mapOrder),this.reportingProperty&&this.makeDonuts()),this.activeCluster&&this.markActiveCluster()}},a.PointClusterer.prototype.mapMove=function(){$(this.map._container).is(":visible")&&(this.map.removeLayer(this.layer),this.makeClusters())},a.PointClusterer.prototype.markActiveCluster=function(){if(null!==this.activeCluster)for(var a in this.layer._layers){var b=this.layer._layers[a]._latlng;b.lat===this.activeCluster._latlng.lat&&b.lng===this.activeCluster._latlng.lng&&$(this.layer._layers[a]._icon).toggleClass("active-marker",!0)}},a.PointClusterer.prototype.removeActiveCluster=function(){this.activeCluster=null,$(".leaflet-marker-pane .active-marker").toggleClass("active-marker",!1)},a.PointClusterer.prototype.removeLayer=function(){this.map.off("moveend",this.mapMove,this),this.map.off("click",this.removeActiveCluster,this),this.map.removeLayer(this.layer)},a.PointClusterer.prototype.replaceLayer=function(){this.map.on("moveend",this.mapMove,this),this.map.on("click",function(){this.removeActiveCluster(!0)},this),this.makeClusters()},a}(QCluster||{}),QCluster=function(a){return a.PointClusterer.prototype.makeDonuts=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p=0;o=this.clusters;for(var q in o){b={},a=this.clusters[q].points;for(var r=a.length-1;r>=0;r--){m=a[r][this.reportingProperty].toString().split(",");for(var s=m.length-1,t=s;t>=0;t--)n=m[t],b.hasOwnProperty(n)?b[n].count++:""===n?b.hasOwnProperty("-9999")?b[-9999].count++:b[-9999]={count:1,color:this.reportingValueNA.color,alias:this.reportingValueNA.label}:("undefined"==typeof this.reportingDictionary[n]&&(p===this.defaultPalette.length&&(p=0),this.reportingDictionary[n]={color:this.defaultPalette[p],label:n},p+=1),b[n]={count:1,color:this.reportingDictionary[n].color,label:this.reportingDictionary[n].label})}c=[],d=[];for(var r in b)c.push(b[r]);for(var u={count:0,color:this.reportingValueNA.color,label:this.reportingValueNA.label},t=0,s=c.length;s>t;t++)c[t].label===this.reportingValueNA.label?u.count=u.count+c[t].count:d.push(c[t]);d.push(u),h=$("."+this.clusterCssClass+"."+q),e=$(h).width(),f=$(h).height(),g=Math.min(e,f)/2,i=d3.layout.pie().sort(null),j=d3.svg.arc().innerRadius(g-g*this.donutIRFrac).outerRadius(g),k=d3.select("."+this.clusterCssClass+"."+q).append("svg").attr("class","clusterDonut").attr("width",e).attr("height",f).append("g").attr("transform","translate("+e/2+","+f/2+")"),l=k.selectAll("path").data(function(){var a,b,c;a=d,b=[];for(var e=0,f=a.length;f>e;e++)b.push(a[e].count);c=i(b);for(var e=0,f=c.length;f>e;e++)c[e].data=a[e];return c}).enter().append("path").attr("fill",function(a){return a.data.color}).attr("d",j)}},a}(QCluster||{}),QCluster=function(a){return a.Utils=function(a){return a.FacetColorLibrary=function(a,b,c,d,e){var f,g,h,i,j,k;return f=e||{},h=f.colorPalette||["#8b722c","#e7dfc7","#040707","#c96228","#80adc0","#a19788","#ddecf2","#9e0000","#03671f","#8e2b5c","#e13066","#5c8276","#efa0cb","#62517b","#2c688b","#56c2a7","#e1df2f","#ed3333","#e69890","#545454"],i=f.maxColors||50,j=f.otherColor||"#666666",k={id:a,name:b,values_keyVal:{},values_arr:[],otherColor:j},_.each(c,function(a,b){var c={id:a[d.id],name:a[d.name],color:a[d.color]};("undefined"==typeof c.color||null===c.color)&&(b>i-1?c.color=j:b>h.length-1?(g=b%h.length-1,c.color=h[g]):c.color=h[b]),k.values_keyVal[c.id]=c,k.values_arr.push(c)}),k},a}(a.Utils||{}),a}(QCluster||{});
//# sourceMappingURL=q-cluster.map.js